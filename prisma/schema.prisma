datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator db {
  provider = "go run github.com/steebchen/prisma-client-go"
  package  = "prisma"
}

model Job {
  id          String      @id @default(uuid())
  name        String
  url         String
  schedule    String
  cronExpr    String
  method      String      @default("POST")
  headers     Json?
  body        String?
  enabled     Boolean     @default(true)
  maxRetries  Int         @default(3)
  timeout     Int         @default(30)
  
  userId      String
  teamId      String?
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  lastRun     DateTime?
  nextRun     DateTime?
  
  executions  Execution[]
  
  @@index([userId])
  @@index([enabled, nextRun])
}

model Execution {
  id           String    @id @default(uuid())
  jobId        String
  status       String
  httpStatus   Int?
  duration     Int
  retryCount   Int       @default(0)
  error        String?
  responseBody String?
  
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  
  job          Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  @@index([jobId, startedAt])
  @@index([status])
}